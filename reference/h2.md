# Calculate heritability from mixed model object

A case-specific wrapper for calculating heritability.

- The upper case prefix `H2_` refers to the wrapper or subfunctions e.g.
  [`H2_Delta()`](https://anu-aagi.github.io/heritable/reference/H2_Delta.md)
  for calculating broad sense heritability

## Usage

``` r
H2(model, target, method = c("Cullis", "Oakey", "Delta", "Piepho", "Standard"), options)
```

## Arguments

- model:

  Model object of class `lmerMod/merMod` or `asreml`

- target:

  The name of the random effect for which heritability is to be
  calculated.

- method:

  Character vector of name of method to calculate heritability. See
  details.

- options:

  NULL by default, for internal checking of model object before
  calculations

## Value

A named numeric vector, length matching number of methods supplied

## Details

The following methods are currently implemented for broad-sense
heritability `H2(method = "XX")`:

- `"Cullis"`: \$\$H^2\_{Cullis} = 1 - \frac{PEV^{BLUP}\_{\overline\Delta
  ij}}{2\sigma^2_g}\$\$

- `"Oakey"`: \$\$H^2\_{Oakey} = \frac{\sum\_{i = n_z+1}^{n_g}
  \lambda_i}{\sum\_{n_g}^{\lambda_i\neq 0}}\$\$

- `"Delta"`: \$\$H^2\_{\Delta ..} = 1 -
  \frac{PEV^{BLUP}\_{\overline\Delta ..}}{2\sigma^2_g}\$\$

- `"Piepho"`: \$\$H^2\_{Piepho} = \frac{\sigma^2_g}{\sigma^2_g +
  \overline{PEV\_{BLUE_g}} / 2}\$\$

- `"Standard"`: \$\$H^2\_{Standard} = \frac{\sigma^2_g}{\sigma^2_g +
  \frac{1}{n_g}\sum\_{n_g}^{i=1} \sigma^2_p / n\_{gi}}\$\$

For further details of a specific method - take a look at help file for
each subfunctions
[`?H2_Cullis`](https://anu-aagi.github.io/heritable/reference/H2_Cullis.md)

## References

- Cullis, B. R., Smith, A. B., & Coombes, N. E. (2006). On the design of
  early generation variety trials with correlated data. Journal of
  Agricultural, Biological, and Environmental Statistics, 11(4),
  381–393. https://doi.org/10.1198/108571106X154443

- Oakey, H., Verbyla, A., Pitchford, W., Cullis, B., & Kuchel, H.
  (2006). Joint modeling of additive and non-additive genetic line
  effects in single field trials. Theoretical and Applied Genetics,
  113(5), 809–819. https://doi.org/10.1007/s00122-006-0333-z

- Schmidt, P., Hartung, J., Rath, J., & Piepho, H.-P. (2019). Estimating
  Broad-Sense Heritability with Unbalanced Data from Agricultural
  Cultivar Trials. Crop Science, 59(2), 525–536.
  https://doi.org/10.2135/cropsci2018.06.0376

- Piepho, H.-P., & Möhring, J. (2007). Computing Heritability and
  Selection Response From Unbalanced Plant Breeding Trials. Genetics,
  177(3), 1881–1888. https://doi.org/10.1534/genetics.107.074229

- Falconer, D. S., & Mackay, T. F. C. (1996). Introduction to
  quantitative genetics (4th ed.). Longman.

## See also

[`H2_Cullis()`](https://anu-aagi.github.io/heritable/reference/H2_Cullis.md),
[`H2_Oakey()`](https://anu-aagi.github.io/heritable/reference/H2_Oakey.md),
[`H2_Delta()`](https://anu-aagi.github.io/heritable/reference/H2_Delta.md),
[`H2_Piepho()`](https://anu-aagi.github.io/heritable/reference/H2_Piepho.md),
[`H2_Standard()`](https://anu-aagi.github.io/heritable/reference/H2_Standard.md)

## Examples

``` r
# lme4 model
lettuce_lme4 <- lme4::lmer(y ~ rep + (1 | gen), data = lettuce_subset)
#> Error: bad 'data': object 'lettuce_subset' not found
H2(lettuce_lme4, target = "gen", method = c("Standard", "Delta"))
#> Error: object 'lettuce_lme4' not found

# asreml model (Requires license)
if (FALSE) { # \dontrun{
lettuce_asreml <- asreml::asreml(fixed = y ~ rep,
                                 random = ~ gen,
                                 data = lettuce_subset,
                                 trace = FALSE
                                 )

H2(lettuce_asreml, target = "gen", method = c("Standard", "Delta"))
} # }
```
